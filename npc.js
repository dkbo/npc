function Dkbo(s){this.id=s.id||"",this.NPCNum=s.NPCNum||1,this.element=document.getElementById(this.id),this.element.width=s.width||400,this.element.height=s.height||200,this.canvas=this.element.getContext("2d"),this.state=s.state||!0,this.img=new Image,this.NPC=this.NPCSet(),this.state&&this.start()}window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,Dkbo.prototype={NPCSet:function(s){var t=[];this.NPCNum=s||this.NPCNum;for(var s=0;s<this.NPCNum;s++){var i=Math.floor(1e4*Math.random()%(this.element.width-32));i=i>=0?i:0;var h=Math.floor(1e4*Math.random()%(this.element.height-48));h=h>=0?h:0,t[s]={id:s,imgSrc:"https://dkbo.github.io/images/man.png",pX:i,pY:h,aX:0,aY:0,aW:this.element.width,aH:this.element.height,mX:0,mY:0,x:0,y:0,w:32,h:48,d:0,l:1,r:2,u:3,t:0,s:0,f:0,footSpeed:8,isR:!1,isU:!1,isD:!1,isL:!1}}return t},draw:function(s,t){var i=this.NPC[s];this.canvas.drawImage(this.img,Math.floor(this.NPC[s].f/i.footSpeed)%4*32,i.h*t,i.w,i.h,i.pX,i.pY,i.w,i.h),i.s>0&&0==t&&i.y<i.mY||i.s>0&&1==t&&i.x>0||i.s>0&&2==t&&i.x<i.mX||i.s>0&&3==t&&i.y>0?(this.NPC[s].f++,this.process(s)):(this.NPC[s].s--,this.NPC[s].f=0)},process:function(s){switch(this.NPC[s].t){case 0:this.NPC[s].y--,this.NPC[s].pY--;break;case 1:this.NPC[s].x++,this.NPC[s].pX++;break;case 2:this.NPC[s].y++,this.NPC[s].pY++;break;case 3:this.NPC[s].x--,this.NPC[s].pX--;break;case 4:this.NPC[s].y--,this.NPC[s].pY--,this.NPC[s].x--,this.NPC[s].pX--;break;case 5:this.NPC[s].y--,this.NPC[s].pY--,this.NPC[s].x++,this.NPC[s].pX++;break;case 6:this.NPC[s].y++,this.NPC[s].pY++,this.NPC[s].x--,this.NPC[s].pX--;break;case 7:this.NPC[s].y++,this.NPC[s].pY++,this.NPC[s].x++,this.NPC[s].pX++}},random:function(s){var t=Math.floor(1e4*Math.random()%8),i=Math.floor(101*Math.random())+10;switch(this.NPC[s].s=1,t){case 0:this.NPC[s].isU=!0,this.NPC[s].y=i,this.NPC[s].t=0,this.draw(s,this.NPC[s].u);break;case 1:this.NPC[s].isR=!0,this.NPC[s].mX=i,this.NPC[s].x=0,this.NPC[s].t=1,this.draw(s,this.NPC[s].r);break;case 2:this.NPC[s].isD=!0,this.NPC[s].mY=i,this.NPC[s].y=0,this.NPC[s].t=2,this.draw(s,this.NPC[s].d);break;case 3:this.NPC[s].isL=!0,this.NPC[s].x=i,this.NPC[s].t=3,this.draw(s,this.NPC[s].l);break;case 4:this.NPC[s].isU=!0,this.NPC[s].isL=!0,this.NPC[s].y=i,this.NPC[s].x=i,this.NPC[s].t=4,this.draw(s,this.NPC[s].l);break;case 5:this.NPC[s].isU=!0,this.NPC[s].isR=!0,this.NPC[s].y=i,this.NPC[s].mX=i,this.NPC[s].x=0,this.NPC[s].t=5,this.draw(s,this.NPC[s].r);break;case 6:this.NPC[s].isD=!0,this.NPC[s].isL=!0,this.NPC[s].mY=i,this.NPC[s].y=0,this.NPC[s].x=i,this.NPC[s].t=6,this.draw(s,this.NPC[s].l);break;case 7:this.NPC[s].isD=!0,this.NPC[s].isR=!0,this.NPC[s].mX=i,this.NPC[s].x=0,this.NPC[s].mY=i,this.NPC[s].y=0,this.NPC[s].t=7,this.draw(s,this.NPC[s].r)}},walk:function(){this.canvas.clearRect(0,0,9999,9999);for(var s,t=0;t<this.NPC.length;t++)s=this.NPC[t],this.img.src=s.imgSrc,s.isU&&s.y>0||s.isU&&s.s>0?s.aY<=s.pY&&s.aX+s.aW-s.w>=s.pX&&s.aX<=s.pX?this.draw(t,s.u):(this.NPC[t].isU=!1,this.NPC[t].isL=!1,this.NPC[t].isR=!1,this.NPC[t].s=0):s.isU&&0==s.y&&(this.NPC[t].isU=!1),s.isD&&s.y<s.mY||s.isD&&s.s>0?s.aY+s.aH-s.h>=s.pY&&s.aX+s.aW-s.w>=s.pX&&s.aX<=s.pX?this.draw(t,s.d):(this.NPC[t].isD=!1,this.NPC[t].isL=!1,this.NPC[t].isR=!1,this.NPC[t].s=0):s.isD&&s.y==s.mY&&(this.NPC[t].isD=!1),s.isR&&s.x<s.mX||s.isR&&s.s>0?5!=s.t&&7!=s.t&&(s.aX+s.aW-s.w>=s.pX?this.draw(t,s.r):(this.NPC[t].isR=!1,this.NPC[t].s=0)):s.isR&&s.x==s.mX&&(this.NPC[t].isR=!1),s.isL&&s.x>0||s.isL&&s.s>0?4!=s.t&&6!=s.t&&(s.aX<=s.pX?this.draw(t,s.l):(this.NPC[t].isL=!1,this.NPC[t].s=0)):s.isL&&0==s.x&&(this.NPC[t].isL=!1),s.isL||s.isD||s.isU||s.isR||0!=this.NPC[t].s||this.random(t);this.state&&window.requestAnimationFrame(this.walk.bind(this))},start:function(){this.state=!0,window.requestAnimationFrame(this.walk.bind(this))},stop:function(){this.state=!1}};
function Dkbo(s){this.id=s.id||"",this.NPCNum=s.NPCNum||1,this.element=document.getElementById(this.id),this.element.width=s.width||400,this.element.height=s.height||200,this.canvas=this.element.getContext("2d"),this.state=s.state||!0,this.img=new Image,this.NPC=[];for(var i=0;i<this.NPCNum;i++)this.NPC.push(this.NPCSet(i));this.state&&window.requestAnimationFrame(this.walk.bind(this))}window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,Dkbo.prototype={NPCSet:function(s){var i=Math.floor(1e4*Math.random()%(this.element.width-32));i=i>=0?i:0;var t=Math.floor(1e4*Math.random()%(this.element.height-48));t=t>=0?t:0;var h={id:s,imgSrc:"http://dkbo.github.io/images/man.png",pX:i,pY:t,aX:0,aY:0,aW:this.element.width,aH:this.element.height,mX:0,mY:0,x:0,y:0,w:32,h:48,d:0,l:1,r:2,u:3,t:0,s:0,f:0,footSpeed:8,isR:!1,isU:!1,isD:!1,isL:!1};return h},draw:function(s,i){var t=this.NPC[s];this.canvas.drawImage(this.img,Math.floor(this.NPC[s].f/t.footSpeed)%4*32,t.h*i,t.w,t.h,t.pX,t.pY,t.w,t.h),t.s>0&&0==i&&t.y<t.mY||t.s>0&&1==i&&t.x>0||t.s>0&&2==i&&t.x<t.mX||t.s>0&&3==i&&t.y>0?(this.NPC[s].f++,this.process(s)):(this.NPC[s].s--,this.NPC[s].f=0)},process:function(s){switch(this.NPC[s].t){case 0:this.NPC[s].y--,this.NPC[s].pY--;break;case 1:this.NPC[s].x++,this.NPC[s].pX++;break;case 2:this.NPC[s].y++,this.NPC[s].pY++;break;case 3:this.NPC[s].x--,this.NPC[s].pX--;break;case 4:this.NPC[s].y--,this.NPC[s].pY--,this.NPC[s].x--,this.NPC[s].pX--;break;case 5:this.NPC[s].y--,this.NPC[s].pY--,this.NPC[s].x++,this.NPC[s].pX++;break;case 6:this.NPC[s].y++,this.NPC[s].pY++,this.NPC[s].x--,this.NPC[s].pX--;break;case 7:this.NPC[s].y++,this.NPC[s].pY++,this.NPC[s].x++,this.NPC[s].pX++}},random:function(s){var i=Math.floor(1e4*Math.random()%8),t=Math.floor(101*Math.random())+10;switch(this.NPC[s].s=1,i){case 0:this.NPC[s].isU=!0,this.NPC[s].y=t,this.NPC[s].t=0,this.draw(s,this.NPC[s].u);break;case 1:this.NPC[s].isR=!0,this.NPC[s].mX=t,this.NPC[s].x=0,this.NPC[s].t=1,this.draw(s,this.NPC[s].r);break;case 2:this.NPC[s].isD=!0,this.NPC[s].mY=t,this.NPC[s].y=0,this.NPC[s].t=2,this.draw(s,this.NPC[s].d);break;case 3:this.NPC[s].isL=!0,this.NPC[s].x=t,this.NPC[s].t=3,this.draw(s,this.NPC[s].l);break;case 4:this.NPC[s].isU=!0,this.NPC[s].isL=!0,this.NPC[s].y=t,this.NPC[s].x=t,this.NPC[s].t=4,this.draw(s,this.NPC[s].l);break;case 5:this.NPC[s].isU=!0,this.NPC[s].isR=!0,this.NPC[s].y=t,this.NPC[s].mX=t,this.NPC[s].x=0,this.NPC[s].t=5,this.draw(s,this.NPC[s].r);break;case 6:this.NPC[s].isD=!0,this.NPC[s].isL=!0,this.NPC[s].mY=t,this.NPC[s].y=0,this.NPC[s].x=t,this.NPC[s].t=6,this.draw(s,this.NPC[s].l);break;case 7:this.NPC[s].isD=!0,this.NPC[s].isR=!0,this.NPC[s].mX=t,this.NPC[s].x=0,this.NPC[s].mY=t,this.NPC[s].y=0,this.NPC[s].t=7,this.draw(s,this.NPC[s].r)}},walk:function(){this.canvas.clearRect(0,0,9999,9999);for(var s,i=0;i<this.NPC.length;i++)s=this.NPC[i],this.img.src=s.imgSrc,s.isU&&s.y>0||s.isU&&s.s>0?s.aY<=s.pY&&s.aX+s.aW-s.w>=s.pX&&s.aX<=s.pX?this.draw(i,s.u):(this.NPC[i].isU=!1,this.NPC[i].isL=!1,this.NPC[i].isR=!1,this.NPC[i].s=0):s.isU&&0==s.y&&(this.NPC[i].isU=!1),s.isD&&s.y<s.mY||s.isD&&s.s>0?s.aY+s.aH-s.h>=s.pY&&s.aX+s.aW-s.w>=s.pX&&s.aX<=s.pX?this.draw(i,s.d):(this.NPC[i].isD=!1,this.NPC[i].isL=!1,this.NPC[i].isR=!1,this.NPC[i].s=0):s.isD&&s.y==s.mY&&(this.NPC[i].isD=!1),s.isR&&s.x<s.mX||s.isR&&s.s>0?5!=s.t&&7!=s.t&&(s.aX+s.aW-s.w>=s.pX?this.draw(i,s.r):(this.NPC[i].isR=!1,this.NPC[i].s=0)):s.isR&&s.x==s.mX&&(this.NPC[i].isR=!1),s.isL&&s.x>0||s.isL&&s.s>0?4!=s.t&&6!=s.t&&(s.aX<=s.pX?this.draw(i,s.l):(this.NPC[i].isL=!1,this.NPC[i].s=0)):s.isL&&0==s.x&&(this.NPC[i].isL=!1),s.isL||s.isD||s.isU||s.isR||0!=this.NPC[i].s||this.random(i);this.state&&window.requestAnimationFrame(this.walk.bind(this))},start:function(){this.state=!0,window.requestAnimationFrame(this.walk.bind(this))},stop:function(){this.state=!1}};